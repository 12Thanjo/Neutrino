$pending_plugins.set('OCS',()=>{let plugin={metadata:{"name":"OCS","version":"0.1.0","description":"ECS architecture thats feature rich and incredibly fast","main":"index.nt","author":"12Thanjo","dependancies":["multithread"]}};let multithread=$get_plugin('multithread');let OCS=function(){console.log('%c OCS Initialized | v0.1.0',"background-color: #00667f ; color: #cccccc ; font-size: 16px ; font-family: 'american typewriter';");let all=function(...conditionals){return {test:(entity)=>{let pass=true;for(var[i,comp]of conditionals.entries()){if(typeof comp=="string"){if(entity[comp]==null){pass=false;break;};}else{if(entity[comp.id]==null){pass=false;break;};};};return pass;}};};let none=function(...conditionals){return {test:(entity)=>{let pass=true;for(var[i,comp]of conditionals.entries()){if(typeof comp=="string"){if(entity[comp]!=null){pass=false;break;};}else{if(entity[comp.id]!=null){pass=false;break;};};};return pass;}};};let some=function(...conditionals){return {test:(entity)=>{let pass=false;for(var[i,comp]of conditionals.entries()){if(typeof comp=="string"){if(entity[comp]!=null){pass=true;break;};}else{if(entity[comp.id]!=null){pass=true;break;};};};return pass;}};};let _Prop_=function(auto){let private={};_Prop_.$map.set(auto,this);this.auto=auto;};_Prop_.$map=new Map();_Prop_.get=function(id){return _Prop_.$map.get(id);};_Prop_.has=function(id){return _Prop_.$map.has(id);};_Prop_.forEach=function(cb){_Prop_.$map.forEach(cb);};_Prop_.delete=function(cb){_Prop_.$map.delete(cb);};let _Component_=function(id,builder){let private={};_Component_.$map.set(id,this);this.id=id;this.builder=builder;};_Component_.$map=new Map();_Component_.get=function(id){return _Component_.$map.get(id);};_Component_.has=function(id){return _Component_.$map.has(id);};_Component_.forEach=function(cb){_Component_.$map.forEach(cb);};_Component_.delete=function(cb){_Component_.$map.delete(cb);};let _Environment_=function(id){let private={};_Environment_.$map.set(id,this);private.id=id;private.entity_id=0;private.entity_lookup=new Map();private.removed=new Set();private.entities=[];let env_priv=private;let _Entity_=function(id,name){let private={};env_priv.entities[id]=this;private.id=id;Object.defineProperty(this, "id", {get: ()=>{return private.id;}});private.name=name;Object.defineProperty(this, "name", {get: ()=>{return private.name;}});if(name!=null){env_priv.entity_lookup.set(private.name,this);let destroy=this.destroy;this.destroy=function(){env_priv.entity_lookup.delete(private.name);env_priv.removed.add(private.id);_Query_.forEach((query)=>{query.audit(this);});destroy();};}else{let destroy=this.destroy;this.destroy=function(){env_priv.removed.add(private.id);_Query_.forEach((query)=>{query.audit(this);});destroy();};};this.bindComponent=function(component,...params){if(component instanceof _Component_){component=component.id;};if(EnvComponent.has(component)==false){throw ReferenceError("Environment ("+env_priv+") does not have component ("+component+")");};let component_target=EnvComponent.get(component);;if(component_target.builder instanceof _Prop_){if(params[0]==null){params[0]=component_target.builder.auto;};this[component]=params[0];}else{let builder_obj=Object.assign({},component_target.builder);;let i=0;let create_component_props=function(builder,depth_arr){if(builder instanceof _Prop_){if(params[i]==null){params[i]=builder.auto;};let target=builder_obj;for(var j=0;j<depth_arr.length-1;j++){target=target[depth_arr[j]];};target[depth_arr[depth_arr.length-1]]=params[i];i+=1;}else{for(let key in builder){let value=builder[key];create_component_props(value,[...depth_arr,key]);};};};create_component_props(builder_obj,[]);this[component]=builder_obj;};_Query_.forEach((query)=>{query.audit(this);});return this;};};let EnvComponent=function(id,builder){let private={};EnvComponent.$map.set(id,this);this.builder=builder;};EnvComponent.$map=new Map();EnvComponent.get=function(id){return EnvComponent.$map.get(id);};EnvComponent.has=function(id){return EnvComponent.$map.has(id);};EnvComponent.forEach=function(cb){EnvComponent.$map.forEach(cb);};EnvComponent.delete=function(cb){EnvComponent.$map.delete(cb);};let _Query_=function(id,conditionals){let private={};_Query_.$map.set(id,this);this.entities=new Set();private.conditionals=conditionals;this.audit=function(entity){let pass=true;for(var[i,conditional]of private.conditionals.entries()){if(conditional.test(entity)==false){pass=false;break;};};if(pass){this.entities.add(entity.id);}else{this.entities.delete(entity.id);};};for(var[i,entity]of env_priv.entities.entries()){if(entity!=null){this.audit(entity);};};this.forEach=function(event){for(var[i,id]of this.entities.entries()){event(env_priv.entities[id]);};};};_Query_.$map=new Map();_Query_.get=function(id){return _Query_.$map.get(id);};_Query_.has=function(id){return _Query_.$map.has(id);};_Query_.forEach=function(cb){_Query_.$map.forEach(cb);};_Query_.delete=function(cb){_Query_.$map.delete(cb);};let _System_=function(id,query,event){let private={};_System_.$map.set(id,this);private.query=_Query_.get(query);private.event=event;this.run=function(){private.query.forEach((entity)=>{private.event(entity);});};this.setupCluster=function(threads){event_str="evnt=($data)=>{$data.data=("+(event.toString())+")($data.data, $data.i);return $data;};";let evnt=null;eval(event_str);private.cluster=new multithread.cluster.forEach(threads,evnt);};this.runThreaded=function(components,callback){let array=[];private.query.forEach((entity)=>{let obj={};for(var[i,component]of components.entries()){obj[component]=entity[component];};array.push(obj);});private.cluster.run(array,(i,data)=>{private.query.forEach((entity)=>{for(var[j,component]of components.entries()){entity[component]=data[component];};});},callback);};this.runThreadedSafe=function(components,callback){let array=[];let entities=[];private.query.forEach((entity)=>{let obj={};for(var[i,component]of components.entries()){obj[component]=entity[component];entities.push(i);};array.push(obj);entities.push(entity);});private.cluster.run(array,(i,data)=>{for(var[j,entity]of entities.entries()){for(var[k,component]of components.entries()){entity[component]=data[component];};};},callback);};};_System_.$map=new Map();_System_.get=function(id){return _System_.$map.get(id);};_System_.has=function(id){return _System_.$map.has(id);};_System_.forEach=function(cb){_System_.$map.forEach(cb);};_System_.delete=function(cb){_System_.$map.delete(cb);};this.bindComponent=function(component){return new EnvComponent(component.id,component.builder);};this.getComponent=function(id){return EnvComponent.get(id);};this.createEntity=function(name){let new_entity=null;if(private.removed.size==0){new_entity=new _Entity_(private.entity_id,name);private.entity_id+=1;}else{let entity_id=private.removed.values().next().value;private.removed.delete(entity_id);new_entity=new _Entity_(entity_id,name);};return new_entity;};this.getEntity=function(name){return private.entity_lookup.get(name);};this.createQuery=function(id,...conditionals){new _Query_(id,conditionals)};this.deleteQuery=function(id){_Query_.delete(id);};this.createSystem=function(id,query,event){return new _System_(id,query,event);};this.getSystem=function(id){return _System_.get(id);};this.deleteSystem=function(id){_System_.delete(id);};};_Environment_.$map=new Map();_Environment_.get=function(id){return _Environment_.$map.get(id);};_Environment_.has=function(id){return _Environment_.$map.has(id);};_Environment_.forEach=function(cb){_Environment_.$map.forEach(cb);};_Environment_.delete=function(cb){_Environment_.$map.delete(cb);};let EventLoop=function(name){let private={};EventLoop.$map.set(name,this);private.name=name;Object.defineProperty(this, "name", {get: ()=>{return private.name;}});private.i=0;private.queue=[];this.add=function(event){private.queue.push(event);};this.next=function(){private.i+=1;try{private.queue[private.i](this.next);}catch{};};this.start=function(){private.i=-1;this.next();};};EventLoop.$map=new Map();EventLoop.get=function(id){return EventLoop.$map.get(id);};EventLoop.has=function(id){return EventLoop.$map.has(id);};EventLoop.forEach=function(cb){EventLoop.$map.forEach(cb);};EventLoop.delete=function(cb){EventLoop.$map.delete(cb);};return {_Environment_:_Environment_,_Component_:_Component_,_Prop_:_Prop_,all:all,none:none,some:some,EventLoop:EventLoop};};plugin=new OCS();;return plugin;});